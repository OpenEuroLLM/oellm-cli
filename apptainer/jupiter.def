Bootstrap: docker
From: nvcr.io/nvidia/pytorch:25.06-py3

%labels
    Author      oellm-cli
    Description Apptainer image for Jupiter JSC cluster (ARM64 / GH200)

%post
    # Install uv into a global bin
    curl -LsSf https://astral.sh/uv/install.sh | env UV_INSTALL_DIR=/usr/local/bin sh

    uv --version

    uv pip install --system --break-system-packages lm-eval \
        "lighteval @ git+https://github.com/huggingface/lighteval.git@63424f4e795ecc577b90646381b374af3a627978" \
        "transformers<=4.53.0" "datasets>=4.0.0" wandb sentencepiece tiktoken accelerate \
        "spacy>=3.0.0,<4.0.0" jieba "underthesea>=6.0.0"
    uv pip install --system --break-system-packages nltk
    mkdir -p /opt/nltk_data
    python - <<'PY'
import nltk
nltk.download('punkt', download_dir='/opt/nltk_data')
nltk.download('punkt_tab', download_dir='/opt/nltk_data')
PY

%environment
    export PATH=/usr/local/bin:$PATH
    export NLTK_DATA=/opt/nltk_data


%runscript
    exec bash "$@"
